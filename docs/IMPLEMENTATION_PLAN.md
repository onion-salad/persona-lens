## Mastraサーバー起動時の注意点・手順

1. プロジェクトルートに `.env` ファイルを必ず作成し、以下の環境変数を設定すること：
   - `VITE_SUPABASE_URL=...`（SupabaseプロジェクトのURL）
   - `VITE_SUPABASE_ANON_KEY=...`（SupabaseのAnon Key）
   - `OPENAI_API_KEY=...`（OpenAIのAPIキー）

2. `.env` ファイルの内容が正しいか確認する。特にURLやAPIキーのtypoに注意。

3. Mastraサーバーの起動は、必ず以下のコマンドで行う：

   ```bash
   npm run mastra:dev
   ```
   - これにより `dotenv-cli` が `.env` を読み込み、Node.js環境にも環境変数が反映される。
   - `npx mastra dev` だけでは環境変数が反映されないため注意。

4. サーバー起動後、APIエンドポイントは `http://localhost:4111/api` で利用可能。

5. `.env` ファイルは `.gitignore` で管理し、絶対にリポジトリにコミットしないこと。

6. エラーが出る場合は、環境変数の設定漏れやtypo、またはポート競合（4111番ポート）を確認する。

---

（このセクションは今後の運用・開発者向けに随時アップデートしてください） 

## 開発計画 (Phase 1: コア機能 - ユーザーアシスタントとしてのオーケストレーター)

### 目標
ユーザーの質問や課題に対し、AIオーケストレーターが対話を通じて目的を明確化し、動的にペルソナを生成・活用して多角的な情報を提供し、ユーザーの意思決定を支援するコア体験を実現する。

### バックエンド

1.  **`OrchestratorAgent` の大幅改修 (最優先)**
    *   [ ] **タスク1.1**: ユーザーの初期入力から目的/課題を理解し、深掘りするための対話ロジック（プロンプトエンジニアリング）を実装する。
        *   完了基準: ユーザーの曖昧な入力に対して、オーケストレーターが明確化のための質問を生成できる。
    *   [ ] **タスク1.2**: 深掘りした目的に基づき、ペルソナ生成の要否、必要なペルソナの数や大まかな属性を判断するロジックを実装する（`EstimatorAgent` の機能を統合または連携）。
        *   完了基準: オーケストレーターが「ペルソナをN名生成します。属性はX, Y, Zです」といった計画を立てられる。
    *   [ ] **タスク1.3**: ペルソナ生成の実行 (`personaFactory` 呼び出し)、および生成されたペルソナへの質問投入ロジックを実装する。
        *   完了基準: 計画に基づきペルソナが生成され、定義された質問が各ペルソナに投げられる。
    *   [ ] **タスク1.4**: 複数のペルソナからの回答を収集し、基本的な形式（例: 各ペルソナの回答リスト）で統合する。
        *   完了基準: 全ペルソナの回答がオーケストレーターによって集約される。
    *   [ ] **タスク1.5**: (オプション) 収集した回答を元に、ユーザーへの追加質問やアクションを提案するロジックを実装する。
        *   完了基準: オーケストレーターが「さらに〇〇について調べますか？」といった提案を生成できる。

2.  **`personaResponder` Agent/Tool の汎用化** (Orchestratorの改修と並行)
    *   [ ] **タスク2.1**: `personaResponder` が、オーケストレーターから渡される多様な質問内容に対応できるようにプロンプトを調整する。
        *   完了基準: 特定の議題だけでなく、様々な種類の質問に対してペルソナが適切な回答を生成できる。

3.  **Mastra Memory の活用検討**
    *   [ ] **タスク3.1**: 複数ターンにわたるユーザーとオーケストレーターの対話履歴や、生成されたペルソナの情報をセッション内で保持・活用する方法を検討・実装する。
        *   完了基準: オーケストレーターが過去の対話内容を踏まえたり、以前生成したペルソナを再利用したりできる。

### フロントエンド

1.  **基本的なUIコンポーネントの実装**
    *   [ ] **タスク4.1**: オーケストレーターとのチャットUIコンポーネントを作成する (メッセージ送受信、表示)。
        *   完了基準: ユーザーがメッセージを入力でき、オーケストレーターからの応答（テキストベース）が表示される。
    *   [ ] **タスク4.2**: ペルソナ情報およびその回答を表形式で表示するコンポーネントを作成する。
        *   完了基準: ペルソナ名、属性概要、回答がテーブルで表示される。
    *   [ ] **タスク4.3**: (オプション) 結果表示エリアのリアルタイム更新機構を検討する (WebSocketなどMastraのストリーミング機能と連携)。
        *   完了基準: ペルソナの回答が順次リアルタイムに表示される（プロトタイプ）。

### その他

1.  **ドキュメント更新**
    *   [x] `app-concept.md` の作成済
    *   [x] `IMPLEMENTATION_PLAN.md` の更新済 (本タスクで実施)
2.  **テスト**
    *   [ ] 各機能の実装後、手動テストおよび必要に応じて自動テストを記述する。 